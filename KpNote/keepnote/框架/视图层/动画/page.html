<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>动画</title>
</head><body>动画<br/>
<span style="color: #ff0000">界面动画的常见方式<br/>
</span><br/>
在小程序中，通常可以使用<span style="color: #ff0000">&nbsp;CSS 渐变 和 CSS 动画</span>&nbsp;来创建<span style="color: #ff0000">简易的界面动画</span>。<br/>
<br/>
在开发者工具中预览效果<br/>
<br/>
动画过程中，可以使用 bindtransitionend bindanimationstart bindanimationiteration bindanimationend 来<span style="color: #ff0000">监听动画事件</span>。<br/>
<br/>
事件名&#09;&#09;&#09;&#09;含义<br/>
transitionend&#09;&#09;CSS 渐变结束或 wx.createAnimation 结束一个阶段<br/>
animationstart&#09;&#09;CSS 动画开始<br/>
animationiteration&#09;CSS 动画结束一个阶段<br/>
animationend&#09;&#09;CSS 动画结束<br/>
<br/>
注意：这几个事件<span style="color: #ff0000">都不是冒泡事件</span>，需要<span style="color: #ff0000">绑定在真正发生了动画的节点上才会生效</span>。<br/>
<br/>
同时，还可以使用 wx.createAnimation 接口来动态创建简易的动画效果。（新版小程序基础库中推荐使用下述的关键帧动画接口代替。）<br/>
<br/>
<span style="color: #ff0000">关键帧动画</span><br/>
基础库 2.9.0 开始支持，低版本需做兼容处理。<br/>
<br/>
从小程序基础库 2.9.0 开始支持一种更友好的动画创建方式，用于代替旧的 wx.createAnimation 。它具有<span style="color: #ff0000">更好的性能和更可控的接口。</span><br/>
<br/>
在页面或自定义组件中，当需要进行关键帧动画时，可以使用 this.animate 接口：<br/>
<br/>
this.animate(selector, keyframes, duration, callback)<br/>
<span style="color: #ff0000">参数说明</span><br/>
<br/>
属性&#09;&#09;类型&#09;&#09;默认值&#09;必填&#09;说明<br/>
selector&#09;&#09;String&#09;&#09;&#09;&#09;是&#09;&#09;选择器（同 SelectorQuery.select 的选择器格式）<br/>
keyframes&#09;Array&#09;&#09;&#09;&#09;是&#09;&#09;关键帧信息<br/>
duration&#09;Number&#09;&#09;&#09;&#09;是&#09;&#09;动画持续时长（毫秒为单位）<br/>
callback&#09;&#09;function&#09;&#09;&#09;&#09;否&#09;&#09;动画完成后的回调函数<br/>
<br/>
<span style="color: #ff0000">keyframes 中对象的结构</span><br/>
<br/>
属性&#09;&#09;&#09;&#09;类型&#09;&#09;&#09;默认值&#09;必填&#09;说明<br/>
offset&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;关键帧的偏移，范围[0-1]<br/>
ease&#09;&#09;&#09;&#09;String&#09;&#09;&#09;linear&#09;否&#09;&#09;动画缓动函数<br/>
<br/>
transformOrigin&#09;&#09;String&#09;&#09;&#09;&#09;&#09;否&#09;&#09;基点位置，即 CSS transform-origin&#09;<br/>
backgroundColor&#09;String&#09;&#09;&#09;&#09;&#09;否&#09;&#09;背景颜色，即 CSS background-color<br/>
<br/>
bottom&#09;&#09;&#09;&#09;Number/String&#09;&#09;&#09;否&#09;&#09;底边位置，即 CSS bottom<br/>
height&#09;&#09;&#09;&#09;Number/String&#09;&#09;&#09;否&#09;&#09;高度，即 CSS height<br/>
left&#09;&#09;&#09;&#09;&#09;Number/String&#09;&#09;&#09;否&#09;&#09;左边位置，即 CSS left<br/>
<br/>
width&#09;&#09;&#09;&#09;Number/String&#09;&#09;&#09;否&#09;&#09;宽度，即 CSS width<br/>
opacity&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;不透明度，即 CSS opacity<br/>
right&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;右边位置，即 CSS right<br/>
top&#09;&#09;&#09;&#09;&#09;Number/String&#09;&#09;&#09;否&#09;&#09;顶边位置，即 CSS top<br/>
<br/>
matrix&#09;&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;变换矩阵，即 CSS transform matrix<br/>
matrix3d&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;三维变换矩阵，即 CSS transform matrix3d<br/>
<br/>
rotate&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;旋转，即 CSS transform rotate<br/>
rotate3d&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;三维旋转，即 CSS transform rotate3d<br/>
rotateX&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;X 方向旋转，即 CSS transform rotateX<br/>
rotateY&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Y 方向旋转，即 CSS transform rotateY<br/>
rotateZ&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Z 方向旋转，即 CSS transform rotateZ<br/>
<br/>
scale&#09;&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;缩放，即 CSS transform scale<br/>
scale3d&#09;&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;三维缩放，即 CSS transform scale3d<br/>
scaleX&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;X 方向缩放，即 CSS transform scaleX<br/>
scaleY&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Y 方向缩放，即 CSS transform scaleY<br/>
scaleZ&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Z 方向缩放，即 CSS transform scaleZ<br/>
<br/>
skew&#09;&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;倾斜，即 CSS transform skew<br/>
skewX&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;X 方向倾斜，即 CSS transform skewX<br/>
skewY&#09;&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Y 方向倾斜，即 CSS transform skewY<br/>
<br/>
translate&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;位移，即 CSS transform translate<br/>
translate3d&#09;&#09;&#09;Array&#09;&#09;&#09;&#09;&#09;否&#09;&#09;三维位移，即 CSS transform translate3d<br/>
translateX&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;X 方向位移，即 CSS transform translateX<br/>
translateY&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Y 方向位移，即 CSS transform translateY<br/>
translateZ&#09;&#09;&#09;Number&#09;&#09;&#09;&#09;&#09;否&#09;&#09;Z 方向位移，即 CSS transform translateZ<br/>
<br/>
示例代码<br/>
在开发者工具中预览效果<br/>
<br/>
<br/>
&nbsp; this.animate('#container', [<br/>
&nbsp; &nbsp; { opacity: 1.0, rotate: 0, backgroundColor: '#FF0000' },<br/>
&nbsp; &nbsp; { opacity: 0.5, rotate: 45, backgroundColor: '#00FF00'},<br/>
&nbsp; &nbsp; { opacity: 0.0, rotate: 90, backgroundColor: '#FF0000' },<br/>
&nbsp; &nbsp; ], 5000, function () {<br/>
&nbsp; &nbsp; &nbsp; this.clearAnimation('#container', { opacity: true, rotate: true }, function () {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; console.log("清除了#container上的opacity和rotate属性")<br/>
&nbsp; &nbsp; &nbsp; })<br/>
&nbsp; }.bind(this))<br/>
<br/>
&nbsp; this.animate('.block', [<br/>
&nbsp; &nbsp; { scale: [1, 1], rotate: 0, ease: 'ease-out' &nbsp;},<br/>
&nbsp; &nbsp; { scale: [1.5, 1.5], rotate: 45, ease: 'ease-in', offset: 0.9},<br/>
&nbsp; &nbsp; { scale: [2, 2], rotate: 90 },<br/>
&nbsp; ], 5000, function () {<br/>
&nbsp; &nbsp; this.clearAnimation('.block', function () {<br/>
&nbsp; &nbsp; &nbsp; console.log("清除了.block上的所有动画属性")<br/>
&nbsp; &nbsp; })<br/>
&nbsp; }.bind(this))<br/>
<br/>
<span style="color: #ff0000">调用 animate API 后会在节点上新增一些样式属性覆盖掉原有的对应样式。</span>如果需要清除这些样式，可在该节点上的动画全部执行完毕后<span style="color: #ff0000">使用 this.clearAnimation 清除这些属性。<br/>
</span><br/>
<span style="color: #ff0000">this.clearAnimation(selector, options, callback)</span><br/>
参数说明<br/>
<br/>
属性&#09;&#09;类型&#09;·&#09;默认值&#09;必填&#09;说明<br/>
selector&#09;&#09;String&#09;&#09;&#09;&#09;是&#09;&#09;选择器（同 SelectorQuery.select 的选择器格式）<br/>
options&#09;&#09;Object&#09;&#09;&#09;&#09;否&#09;&#09;需要清除的属性，不填写则全部清除<br/>
callback&#09;&#09;Function&#09;&#09;&#09;否&#09;&#09;清除完成后的回调函数<br/>
<br/>
<b><span style="color: #ff0000">滚动驱动的动画<br/>
</span></b><br/>
我们发现，<span style="color: #ff0000">根据滚动位置而不断改变动画的进度是一种比较常见的场景</span>，这类动画可以让人感觉到界面交互很连贯自然，体验更好。因此<span style="color: #ff0000">，从小程序基础库 2.9.0 开始支持一种由滚动驱动的动画机制。</span><br/>
<br/>
基于上述的关键帧动画接口，新增一个 <span style="color: #ff0000">ScrollTimeline</span>&nbsp;的参数，用来<span style="color: #ff0000">绑定滚动元素</span>（目前只支持 scroll-view）。接口定义如下：<br/>
<br/>
this.animate(selector, keyframes, duration, ScrollTimeline)<br/>
<br/>
<span style="color: #ff0000">ScrollTimeline 中对象的结构</span><br/>
<br/>
属性&#09;&#09;&#09;类型&#09;默认值&#09;必填&#09;说明<br/>
scrollSource&#09;&#09;String&#09;&#09;&#09;是&#09;&#09;指定滚动元素的选择器（只支持 scroll-view），该元素滚动时会驱动动画的进度<br/>
orientation&#09;&#09;String&#09;vertical&#09;否&#09;&#09;指定滚动的方向。有效值为 horizontal 或 vertical<br/>
startScrollOffset&#09;Number&#09;&#09;&#09;是&#09;&#09;指定开始驱动动画进度的滚动偏移量，单位 px<br/>
endScrollOffset&#09;Number&#09;&#09;&#09;是&#09;&#09;指定停止驱动动画进度的滚动偏移量，单位 px<br/>
timeRange&#09;&#09;Number&#09;&#09;&#09;是&#09;&#09;起始和结束的滚动范围映射的时间长度，该时间可用于与关键帧动画里的时间 (duration) 相匹配，单位 ms<br/>
<br/>
示例代码<br/>
在开发者工具中预览效果<br/>
<br/>
&nbsp; this.animate('.avatar', [{<br/>
&nbsp; &nbsp; borderRadius: '0',<br/>
&nbsp; &nbsp; borderColor: 'red',<br/>
&nbsp; &nbsp; transform: 'scale(1) translateY(-20px)',<br/>
&nbsp; &nbsp; offset: 0,<br/>
&nbsp; }, {<br/>
&nbsp; &nbsp; borderRadius: '25%',<br/>
&nbsp; &nbsp; borderColor: 'blue',<br/>
&nbsp; &nbsp; transform: 'scale(.65) translateY(-20px)',<br/>
&nbsp; &nbsp; offset: .5,<br/>
&nbsp; }, {<br/>
&nbsp; &nbsp; borderRadius: '50%',<br/>
&nbsp; &nbsp; borderColor: 'blue',<br/>
&nbsp; &nbsp; transform: `scale(.3) translateY(-20px)`,<br/>
&nbsp; &nbsp; offset: 1<br/>
&nbsp; }], 2000, {<br/>
&nbsp; &nbsp; scrollSource: '#scroller',<br/>
&nbsp; &nbsp; timeRange: 2000,<br/>
&nbsp; &nbsp; startScrollOffset: 0,<br/>
&nbsp; &nbsp; endScrollOffset: 85,<br/>
&nbsp; })<br/>
<br/>
&nbsp; this.animate('.search_input', [{<br/>
&nbsp; &nbsp; opacity: '0',<br/>
&nbsp; &nbsp; width: '0%',<br/>
&nbsp; }, {<br/>
&nbsp; &nbsp; opacity: '1',<br/>
&nbsp; &nbsp; width: '100%',<br/>
&nbsp; }], 1000, {<br/>
&nbsp; &nbsp; scrollSource: '#scroller',<br/>
&nbsp; &nbsp; timeRange: 1000,<br/>
&nbsp; &nbsp; startScrollOffset: 120,<br/>
&nbsp; &nbsp; endScrollOffset: 252<br/>
&nbsp; })<br/>
<br/>
<span style="color: #ff0000">高级的动画方式</span><br/>
在一些复杂场景下，上述的动画方法可能并不适用。<br/>
<br/>
<span style="color: #ff0000">WXS 响应事件 的方式</span>可以通过使用 WXS 来响应事件的方法来动态调整节点的 style 属性。通过不断改变 style 属性的值可以做到动画效果。同时，这种方式也可以根据用户的触摸事件来动态地生成动画。<br/>
<br/>
连续使用 setData 来改变界面的方法也可以达到动画的效果。这样可以任意地改变界面，但通常会产生较大的延迟或卡顿，甚至导致小程序僵死。此时可以通过<span style="color: #ff0000">将页面的 setData 改为 自定义组件 中的 setData 来提升性能</span>。下面的例子是使用 setData 来实现秒表动画的示例。<br/>
<br/>
</body></html>