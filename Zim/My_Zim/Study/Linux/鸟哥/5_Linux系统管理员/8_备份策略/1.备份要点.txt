Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2017-11-22T13:44:25+08:00

====== 1.备份要点 ======
Created Wednesday 22 November 2017

1. 备份要点
　　1.1 备份数据的考量
　　1.2 哪些 Linux 数据具有备份的意义
　　1.3 备份用储存媒体的选择
 大标题的图示备份要点
备份是个很重要的工作，很多人总是在系统损毁的时候才在哀嚎说：『我的数据啊！天那...！』此时才会发现备份数据的可爱！ 但是备份其实也非常可怕！因为你的重要数据都在备份档里面，如果这个备份被窃取或遗失，其实对你的系统资安影响也非常大！ 同时，备份使用的媒体选择也非常多样，但是各种储存媒体各有其功能与优劣，所以当然得要选择罗！闲话少说，来谈谈备份吧！


小标题的图示备份数据的考量
老实说，备份是系统损毁时等待救援的救星！因为你需要重新安装系统时， 备份的好坏会影响到你系统复原的进度！不过，我们想先知道的是，系统为什么会损毁啊？是人为的还是怎样产生的啊？ 事实上，系统有可能由於不预期的伤害而导致系统发生错误！ 什么是不预期的伤害呢？这是由於系统可能因为不预期的硬件损坏，例如硬盘坏掉等等，或者是软件问题导致系统出错， 包括人为的操作不当或是其他不明因素等等所致。底下我们就来谈谈系统损坏的情况与为何需要备份吧！


造成系统损毁的问题-硬件问题
基本上，『计算机是一个相当不可靠的机器』这句话在大部分的时间内还是成立的！ 常常会听到说『要计算机正常的工作，最重要的是要去拜拜！』嘿嘿！不要笑！这还是真的哩！ 尤其是在日前一些计算机周边硬件的生产良率 (就是将硬件产生出来之后，经过测试， 发现可正常工作的与不能正常工作的硬件总数之比值) 越来越差的情况之下，计算机的不稳定状态实在是越来越严重了！

举个例子来说，鸟哥曾经同时买过同一厂牌的 30GB 硬盘三颗，回来之后经过一个星期，嘿嘿！挂掉了两颗！ 其中一颗是有坏轨，另外一颗是『完全死掉』，拿去公司要求修理，结果呢？嗯！店家直接拿了一颗新的给我， 害我吓一跳，店家的工程师说『唉呀！目前这个牌子的良率太差了，所以代理商为了怕麻烦，都会直接拿新的替换给我们啦！』 要晓得的是，当初那一颗完全死掉的硬盘，是我用来备份我的主机数据的.... 好在当时我将备份的数据放在三四个地方，还好...

一般来说，会造成系统损毁的硬件组件应该要算硬盘吧！因为其他的组件坏掉时，虽然会影响到系统的运行， 不过至少我们的数据还是存在硬盘当中的啊！为了避免这个困扰，於是乎有可备份用的 RAID1, RAID5 等磁盘阵列的应用啊！但是如果是 RAID 控制芯片坏掉呢？这就麻烦了～所以说，如果有 RAID 系统时， 鸟哥个人还是觉得需要进行额外的备份才好的！如果数据够重要的话。


造成系统损毁的问题-软件问题
根据分析，其实系统的软件伤害最严重的就属使用者的操作不当啦！像最近这几天才在鸟园讨论区发现， 有网友手滑了一下，结果在命令列输入了『 rm -rf /home 』，这造成什么后果？就造成使用者家目录被删光光～ 因为当时下达命令的身份是 root 啊～会欲哭无泪喔！为了避免这方面的『手滑』问题，备份是重要的！

软件伤害除了来自主机上的使用者操作不当之外，最常见的可能是资安攻击事件了。 假如你的 Linux 系统上面某些 Internet 的服务软件是最新的！这也意味著可能是『相对最安全的』， 但是，这个世界目前的闲人是相当多的，你不知道什么时候会有所谓的『黑客软件』被提供出来，万一你在 Internet 上面的服务程序被攻击，导致你的 Linux 系统全毁，这个时候怎么办？当然是要复原系统吧？

那如何复原被伤害的系统呢？『重新安装就好啦！』或许你会这么说， 但是，像鸟哥管理的几个网站的数据，尤其是 MySQL 数据库的数据，这些都是弥足珍贵的经验数据， 万一被损毁而救不回来的时候，不是很可惜吗？这个还好哩，万一你是某家银行的话， 那么数据的损毁可就不是能够等闲视之的！关系的可是数千甚至上万人的身家财产！这就是备份的重要性了！ 他可以最起码的稍微保障我们的数据有另外一份 copy 的备援以达到『安全回复』的基本要求！


主机角色不同，备份任务也不同
由於软硬件的问题都可能造成系统的损毁，所以备份当然就很重要啦！问题是，每一部主机都需要备份吗？ 多久备份一次呢？要备份什么数据呢？

如果是针对个人桌上型计算机使用的数据，那么 Norton 的『 Ghost 』应该算是一套好到不行的备份大师了！ 最主要是 Ghost 可以针对整个 partition 来进行备份，所以罗，我们可以将 Windows 系统当中的整个 C 或者是整个 D 槽完整的备份下来。甚至在还原方面也是非常的快速，而且操作简便！ 另外，由於个人桌上型计算机所使用的数据量通常不大，所以当 ghost 完成之后，通常只要将数据烧录到光盘片当中，大约只要一至两片的光盘片也就绰绰有余罗！ 那么将光盘片保存好，这就是最简易的数据备份模式罗！ 此外，由於个人的数据变动性不大，所以数据的备份频率方面也不需要非常的频繁！

但是，万一你的主机有提供 Internet 方面的服务呢？又该如何备份啊？举个例子来说，像是我们 Study Area 团队的讨论局域网站 http://phorum.study-area.org 提供的是类似 BBS 的讨论文章， 虽然数据量不大，但是由於讨论区的文件是天天在添加的，每天都有相当多的资讯流入， 由於某些资讯都是属於重要的人物之留言，这个时候，我们能够让机器死掉吗？或者是能够一季三个月才备份一次吗？ 这个备份频率需求的考量是非常重要的！

再提到 2002 年左右鸟哥的讨论区曾经挂点的问题，以及 2003 年初 Study-Area 讨论区挂点的问题，讨论区一旦挂点的话，该数据库内容如果损毁到无法救回来， 嘿嘿！要晓得讨论区可不是一个人的心血耶！有的时候 (像 Study-Area 讨论区) 是一群热心 Linux 的朋友们互相创建交流起来的数据流通网，如果死掉了，那么不是让这些热血青年的热情付之一炬了吗？ 所以罗，创建备份的策略 (频率、媒体、方法等) 是相当的重要的。


备份因素考量
由於计算机 (尤其是目前的计算机，操作频率太高、硬件良率太差、使用者操作习惯不良、 『某些』操作系统的死机率太高....) 的稳定性较差，所以罗！备份的工作就越来越重要了！ 那么一般我们在备份时考虑的因素有哪些呢？

备份哪些文件：
哪些数据对系统或使用者来说是重要的？那些数据就是值得备份的数据！例如 /etc/* 及 /home/* 等。

选择什么备份的媒介：
是可读写光盘、另一颗硬盘、同一颗硬盘的不同 partition、还是使用网络备援系统？ 哪一种的速度最快，最便宜，可将数据保存最久？这都可以考虑的。

考虑备份的方式：
是以完整备份(类似 ghost)来备份所有数据，还是使用差异备份仅备份有被更动过的数据即可？

备份的频率：
例如 MySQL 数据库是否天天备份、若完整备份，需要多久进行一次？

备份使用的工具为何：
是利用 tar 、 cpio 、 dd 还是 dump 等等的备份工具？
底下我们就来谈一谈这些问题的解决之道吧！ ^_^

小标题的图示哪些 Linux 数据具有备份的意义
一般来说，鸟哥比较喜欢备份最重要的文件而已 (关键数据备份)，而不是整个系统都备份起来 (完整备份, Full backup)！那么哪些文件是有必要备份的呢？具有备份意义的文件通常可以粗分为两大类，一类是系统基本配置资讯、一类则是类似网络服务的内容数据。 那么各有哪些文件需要备份的呢？我们就来稍微分析一下。


操作系统本身需要备份的文件：
这方面的文件主要跟『帐号与系统配置档』有关系！ 主要有哪些帐号的文件需要备份呢？就是 /etc/passwd, /etc/shadow, /etc/group, /etc/gshadow, /home 底下的使用者家目录等等， 而由於 Linux 默认的重要参数档都在 /etc/ 底下，所以只要将这个目录备份下来的话， 那么几乎所有的配置档都可以被保存的！

至於 /home 目录是一般用户的家目录，自然也需要来备份一番！再来，由於使用者会有邮件吧！所以呢，这个 /var/spool/mail/ 内容也需要备份呦！另外，由於如果你曾经自行更动过核心，那么 /boot 里头的资讯也就很重要罗！所以罗，这方面的数据你必须要备份的文件为：

/etc/ 整个目录
/home 整个目录
/var/spool/mail
/boot
/root
如果你自行安装过其他的套件，那么 /usr/local/ 或 /opt 也最好备份一下！

网络服务的数据库方面：
这部份的数据可就多而且复杂了，首先是这些网络服务软件的配置档部分， 如果你的网络软件安装都是以原厂提供的为主，那么你的配置文件大多是在 /etc 底下，所以这个就没啥大问题！但若你的套件大多来自於自行的安装，那么 /usr/local 这个目录可就相当的重要了！

再来，每种服务提供的数据都不相同，这些数据很多都是人们提供的！举例来说，你的 WWW 服务器总是需要有人提供网页文件吧？否则浏览器来是要看啥咚咚？你的讨论区总是得要写入数据库系统吧？ 否则讨论的数据如何升级与记载？所以，使用者主动提供的文件，以及服务运行过程会产生的数据， 都需要被考虑来备份。若我们假设我们提供的服务软件都是使用原厂的 RPM 安装的！所以要备份的数据文件有：

软件本身的配置文件，例如：/etc/ 整个目录，/usr/local/ 整个目录
软件服务提供的数据，以 WWW 及 MySQL 为例：
WWW 数据：/var/www 整个目录或 /srv/www 整个目录，及系统的使用者家目录
MySQL ： /var/lib/mysql 整个目录
其他在 Linux 主机上面提供的服务之数据库文件！

推荐需要备份的目录：
由上面的介绍来看的话，如果你的硬件或者是由於经费的关系而无法全部的数据都予以备份时， 鸟哥建议你至少需要备份这些目录呦！

/boot
/etc
/home
/root
/usr/local(或者是 /opt 及 /srv 等)
/var(注：这个目录当中有些缓存目录则可以不备份！)

不需要备份的目录：
有些数据是不需要备份的啦！例如我们在第六章文件权限与目录配置里头提到的 /proc 这个目录是在记录目前系统上面正在跑的程序，这个数据根本就不需要备份的呢！此外，外挂的机器，例如 /mnt 或 /media 里面都是挂载了其他的硬盘装置、光驱、软盘机等等，这些也不需要备份吧？ 所以罗！底下有些目录可以不需要备份啦！

/dev ：这个随便你要不要备份
/proc：这个真的不需要备份啦！
/mnt 与 /media：如果你没有在这个目录内放置你自己系统的东西，也不需要备份
/tmp ：干嘛存缓存档！不需要备份！
小标题的图示备份用储存媒体的选择
用来储存备份数据的媒体非常的多样化，那该如何选择呢？在选择之前我们先来讲个小故事先！


一个实际发生的故事
在备份的时候，选择一个『数据存放的地方』也是很需要考虑的一个因素！ 什么叫做数据存放的地方呢？讲个最简单的例子好了，我们知道说，较为大型的机器都会使用 tape 这一种磁带机来备份数据，而如果是一般个人计算机的话，很可能是使用类似 Mo 这一种可读写式光盘片来存取数据！但是你不要忘记了几个重要的因素，那就是万一你的 Linux 主机被偷了呢？

这不是不可能的，之前鸟哥在成大念书时，隔壁校区的研究室曾经遭小偷， 里面所有的计算机都被偷走了！包括『Mo 片』，当他们发现的时候，一开始以为是硬件被偷走了，还好， 他们都有习惯进行备份，但是很不幸的，这一次连『备份的 MO 都被拿走了！』怎么办？！只能道德劝说小偷先生能够良心发现的将硬盘拿回来罗！唉～真惨....


异地备援系统
这个时候，所谓的『异地备援系统』就显的相当的重要了！ 什么是异地备援呀！说的太文言了！呵！简单的说，就是将你的系统数据『备份』到其他的地方去， 例如说我的机器在台南，但是我还有另一部机器在高雄老家，这样的话， 我可以将台南机器上面重要的数据都给他定期的自动的透过网络传输回去！ 也可以将家里重要的数据给他丢到台南来！这样的最大优点是可以在台南的机器死掉的时候， 即使是遭小偷，也可以有一个『万一』的备份所在！

有没有缺点啊？有啊！缺点就是～频宽严重的不足！ 在这种状态下，所能采取的策略大概就是『仅将最重要的数据给他传输回去罗！』 至於一些只要系统从新安装就可以回复的咚咚！那就没有这个必要了！当然罗，如果你的网络是属於 T1 专线的话，那么完整备份将数据丢到另一地去，也是很可行的啦！只是鸟哥没有那么好命...


储存媒体的考量
在此同时，我们再来谈一谈，那么除了异地备援这个『相对较为安全的备份』方法之外， 还有没有其他的方法可以储存备份的呢？毕竟这种网络备援系统实在是太耗频宽了！如果像我们一般家用的 ADSL 根本就是吃不消！那么怎么办？喔～那就只好使用近端的装置来备份罗！ 这也是目前我们最常见到的备份方法！例如一般我们使用的 Tape, Mo, Zip, CD-RW, DVD-RW 还有备份用抽取式硬盘与携带式硬盘等等！ 那么在选择上需要注意些什么呢？需要注意的地方有几点：

备份速度要求 -- 思考硬盘用途：

『备份』在 Linux 主机上面也是蛮耗系统资源的！因为需要将系统的数据拷贝到其他装置上面去，这个时候 I/O 与 CPU 的负载都会大！你总不希望系统就这样给他挂点吧！此外，有些系统的数据实在太多咯， 怎么样也备份不完！所以罗，越快的储存装置是越好的！如果你是个重视速度甚於一切的人， 那么我觉得抽取式硬盘是个不错的方式，只不过.....目前我知道的抽取式硬盘都需要冷启动才行，不太符合 Linux 主机 24 小时全年无休的状态....

但是硬盘真的越来越大、越来越便宜了，不使用速度快的硬盘来备份实在很可惜～ 加上目前的火线 (IEEE 1394) 以及 U盘 2.0 外接式硬盘盒技术已经相当的成熟， 传输速度又快，又可以直接热拔插 (Plug and Play)，接上 U盘 硬盘， 整个复制一下，传输速度理论上可达 480Mbps (约 60 MBytes/second) ，快的哩！ 复制完毕，又可以将硬盘带走，不需要与主机放置在一起，还可以避免同时被偷，真是不错。

但是，硬盘还是有一定的困扰，那就是『不接电源的硬盘需要很好很好的保养』。 我们知道计算机最好的保养就是常常启动去运行一下，免得长期不启动，造成受潮而损坏。 这个携带式硬盘只是偶而才会连上主机来进行备份的数据，除非你额外购买一部防潮箱来放置硬盘， 否则很容易损坏！所以，近年来速度越来越快的 DVD-RW 就变的很方便罗！至於磁带 (tape)，在速度上完全是落后的.....

至於使用直接安装在主机上的第二颗硬盘来备份，类似 RAID 或者是安装一颗备份的硬盘在 Linux 系统当中，这个方案也很好， 而且速度上绝对是最具优势的！但是就如同我们刚刚提到的，万一你的机器被偷了，连带的， 这颗备份的硬盘自然也就不见了.....

储存容量 -- 磁带备份考量：

这也是一个需要考量的因素！而且常常是最大考量的因素呢！虽然目前硬盘越来越便宜， 但是毕竟就如同前面说的，抽取式硬盘需要将系统冷启动，而建构在系统内的硬盘又同时具有不安全的成分在， 携带式硬盘可能又有不容易保存的特性，这个时候一个大容量的替代方案就显的很重要了！虽然 CD-RW 与 DVD-RW 可以提供不错的速度，但是其容量毕竟不足 (虽然有高达几十 GB 的蓝光 DVD 可用，但目前 (2009) 尚未普及， 光盘片太贵了！) 所以说，具有大容量的 tape (磁带容量最小的一款也可以到达 8 GB 左右！) 就相当的具有这方面的优势了！而且携带方便，存放也容易！更可以带著走～～

经费与数据可靠性 -- DVD 的使用，可保存 10 年左右：

在经费不短缺的情况下，我们当然会建议你上面的几个装置都买一买， 然后分别在不同的时间进行不同的备份作业 (底下我们有些建议的啦！^_^) ！但是如果经费也是需要考量的话，那么磁带机这个目前还算贵重的物品可能暂时还动不到！ 这个时候近来渐渐便宜的 DVD-RW 就显的活跃的多了！而且光盘片也可以保存很久的ㄋㄟ～ 当然，目前应该不会有人以软盘来备份了吧！呵呵！软盘可是相当不安全的。
无论如何，如果经费允许的话， Tape 备份数据真的是一个不错的点子！因为他的高容量让我好满意！ 再来，如果经费稍微短缺的话，那么 DVD-RW 经常性的将数据烧录下来，这也是蛮好的，尤其 DVD 片又不占空间！再来，如果还是没有办法，那么一颗内建在 Linux 的硬盘用来备份也是不错的！ 什么！连备份的硬盘都没有，唉！怎么跟我一样～这个时候没办法啦，用原来的安装系统的硬盘，多留一个 partition 用来当作备份之用吧 (这也是目前鸟哥常用的方法之一！)底下我们来看一看一些常见的装置代号！

光驱： /dev/cdrom (其实应该是 /dev/sdX 或 /dev/hdX)
磁带机： /dev/st0 (SCSI 介面), /dev/ht0 (IDE 介面)
软盘机： /dev/fd0, /dev/fd1
硬盘机： /dev/hd[a-d][1-63] (IDE), /dev/sd[a-p][1-16] (SCSI/SATA)
外接式 U盘 硬盘机： /dev/sd[a-p][1-16] (与 SCSI 相同)
打印机： /dev/lp[0-2]
特别留意的是磁带机呦！如果你有钱的话，那么买一部磁带机是相当不错的建议！没钱的话，买 IDE 或 SATA 介面的硬盘也很不错！！ ^_^
